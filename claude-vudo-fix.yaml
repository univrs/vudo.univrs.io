# claude-flow-vudo-mobile-fix.yaml
#
# Mission: Fix vudo.univrs.io mobile rendering + add light/dark toggle
# Compare with working sites: univrs.io and learn.univrs.io
#
# Run: npx claude-flow@alpha swarm "read claude-flow-vudo-mobile-fix.yaml --workflow fix-vudo-mobile"

name: vudo-mobile-fix
description: Fix mobile rendering issues and add theme toggle to vudo.univrs.io

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AGENTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

agents:
  # Agent 1: Analyze and compare all three sites
  site-analyzer:
    name: Site Analyzer
    role: Compare working sites with broken vudo.univrs.io
    instructions: |
      You are analyzing why vudo.univrs.io doesn't render on mobile browsers while
      univrs.io and learn.univrs.io work correctly.

      TASKS:
      1. Compare the three repos:
         - ~/repos/univrs.io
         - ~/repos/learn.univrs.io
         - ~/repos/vudo.univrs.io

      2. Check these critical mobile-breaking issues:

         a) index.html viewport meta tag:
            - Must have: <meta name="viewport" content="width=device-width, initial-scale=1.0">
            - Check if vudo has this, compare with working sites

         b) CSS/Tailwind issues:
            - Check tailwind.config.ts content paths
            - Check if CSS is being generated correctly
            - Look for any fixed positioning that breaks mobile

         c) Three.js/WebGL issues (MOST LIKELY CULPRIT):
            - MyceliumBackground.tsx uses Three.js Canvas
            - Mobile WebGL context may fail silently
            - Check if Canvas has proper fallback
            - Look for gl context errors that block rendering

         d) React hydration issues:
            - Check if Suspense fallback shows on mobile
            - Look for SSR/CSR mismatches

         e) Package.json differences:
            - Compare dependencies between sites
            - Check for mobile-incompatible packages

      3. Create a report file: ~/repos/vudo.univrs.io/MOBILE_ANALYSIS.md
         - Document all differences found
         - Identify the root cause
         - Propose specific fixes

      OUTPUT: MOBILE_ANALYSIS.md with findings and recommendations

  # Agent 2: Fix mobile rendering
  mobile-fixer:
    name: Mobile Fixer
    role: Implement fixes for mobile rendering
    dependencies:
      - site-analyzer
    instructions: |
      Based on the analysis from site-analyzer, fix vudo.univrs.io mobile issues.

      LIKELY FIXES NEEDED:

      1. MyceliumBackground.tsx - Add mobile detection and fallback:
         ```tsx
         // Detect mobile/low-power devices
         const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
         const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

         // Return static fallback instead of WebGL on mobile
         if (isMobile || prefersReducedMotion) {
           return <StaticBackground />;
         }
         ```

      2. Add a StaticBackground component:
         - CSS gradient background matching the color scheme
         - Optional: Static SVG mycelium pattern
         - Must be lightweight for mobile

      3. Check viewport meta tag in index.html:
         ```html
         <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
         ```

      4. Add error boundary around Canvas:
         ```tsx
         <ErrorBoundary fallback={<StaticBackground />}>
           <Canvas>...</Canvas>
         </ErrorBoundary>
         ```

      5. Check CSS for mobile breakpoints:
         - Ensure text sizes are readable
         - Check for overflow-x issues
         - Verify touch targets are 44px minimum

      FILES TO MODIFY:
      - ~/repos/vudo.univrs.io/src/components/MyceliumBackground.tsx
      - ~/repos/vudo.univrs.io/index.html (if viewport missing)
      - ~/repos/vudo.univrs.io/src/App.tsx (if error boundary needed)

      TEST: Run `npm run build` and verify no errors

  # Agent 3: Add theme toggle
  theme-implementer:
    name: Theme Implementer
    role: Add light/dark mode toggle
    dependencies:
      - mobile-fixer
    instructions: |
      Add a light/dark mode toggle to vudo.univrs.io.

      Reference how univrs.io and learn.univrs.io implement theming.

      IMPLEMENTATION:

      1. Create ThemeProvider context (src/contexts/ThemeContext.tsx):
         ```tsx
         import { createContext, useContext, useState, useEffect } from 'react';

         type Theme = 'dark' | 'light';

         const ThemeContext = createContext<{
           theme: Theme;
           toggleTheme: () => void;
         }>({ theme: 'dark', toggleTheme: () => {} });

         export function ThemeProvider({ children }) {
           const [theme, setTheme] = useState<Theme>('dark');

           useEffect(() => {
             // Check localStorage and system preference
             const stored = localStorage.getItem('vudo-theme') as Theme;
             const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
             setTheme(stored || (systemDark ? 'dark' : 'light'));
           }, []);

           useEffect(() => {
             document.documentElement.classList.toggle('light', theme === 'light');
             localStorage.setItem('vudo-theme', theme);
           }, [theme]);

           const toggleTheme = () => setTheme(t => t === 'dark' ? 'light' : 'dark');

           return (
             <ThemeContext.Provider value={{ theme, toggleTheme }}>
               {children}
             </ThemeContext.Provider>
           );
         }

         export const useTheme = () => useContext(ThemeContext);
         ```

      2. Create ThemeToggle component (src/components/ThemeToggle.tsx):
         ```tsx
         import { useTheme } from '../contexts/ThemeContext';
         import { motion } from 'framer-motion';

         export function ThemeToggle() {
           const { theme, toggleTheme } = useTheme();

           return (
             <button
               onClick={toggleTheme}
               className="fixed top-6 right-6 z-50 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors"
               aria-label="Toggle theme"
             >
               <motion.div
                 animate={{ rotate: theme === 'dark' ? 0 : 180 }}
                 transition={{ duration: 0.3 }}
               >
                 {theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸'}
               </motion.div>
             </button>
           );
         }
         ```

      3. Update tailwind.config.ts for light mode:
         ```ts
         export default {
           darkMode: 'class',
           // ... rest of config
         }
         ```

      4. Update index.css with light mode variables:
         ```css
         :root {
           --bg-primary: #0a0a0f;
           --text-primary: #ffffff;
           --glow-color: #00ff88;
         }

         .light {
           --bg-primary: #f8fafc;
           --text-primary: #0f172a;
           --glow-color: #059669;
         }
         ```

      5. Update App.tsx:
         - Wrap with ThemeProvider
         - Add ThemeToggle component
         - Update color classes to use CSS variables or dark: prefix

      6. Update components to support light mode:
         - Hero.tsx: text colors
         - VevePattern.tsx: stroke colors
         - Roadmap.tsx: background and text
         - DOLPlayground.tsx: editor colors

      FILES TO CREATE:
      - ~/repos/vudo.univrs.io/src/contexts/ThemeContext.tsx
      - ~/repos/vudo.univrs.io/src/components/ThemeToggle.tsx

      FILES TO MODIFY:
      - ~/repos/vudo.univrs.io/tailwind.config.ts
      - ~/repos/vudo.univrs.io/src/index.css
      - ~/repos/vudo.univrs.io/src/App.tsx
      - ~/repos/vudo.univrs.io/src/components/*.tsx (as needed)

  # Agent 4: Test and validate
  validator:
    name: Validator
    role: Test all changes work correctly
    dependencies:
      - theme-implementer
    instructions: |
      Validate all changes work correctly.

      TESTS:

      1. Build test:
         ```bash
         cd ~/repos/vudo.univrs.io
         npm run build
         ```
         - Must complete with no errors
         - Check for TypeScript errors
         - Check for unused imports warnings

      2. Mobile simulation test:
         ```bash
         npm run preview
         ```
         - Open Chrome DevTools
         - Toggle device toolbar (Ctrl+Shift+M)
         - Test iPhone SE, iPhone 12, Pixel 5
         - Verify content renders
         - Verify no horizontal scroll
         - Verify touch targets are usable

      3. Theme toggle test:
         - Click toggle, verify colors change
         - Refresh page, verify theme persists
         - Check all sections in both themes

      4. Performance check:
         - Mobile should load in < 3s
         - No WebGL errors in console
         - Fallback should be smooth

      5. Create test report:
         ~/repos/vudo.univrs.io/TEST_REPORT.md
         - Build status
         - Mobile rendering status
         - Theme toggle status
         - Any remaining issues

      6. If all tests pass, commit changes:
         ```bash
         git add -A
         git commit -m "fix: mobile rendering + feat: light/dark theme toggle"
         ```

      DO NOT PUSH - leave that for human review

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOWS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

workflows:
  fix-vudo-mobile:
    name: Fix VUDO Mobile + Add Theme Toggle
    description: Compare sites, fix mobile, add theming
    stages:
      - name: analyze
        description: Compare repos and identify issues
        agents:
          - site-analyzer

      - name: fix-mobile
        description: Implement mobile fixes
        agents:
          - mobile-fixer
        depends_on:
          - analyze

      - name: add-theme
        description: Implement light/dark toggle
        agents:
          - theme-implementer
        depends_on:
          - fix-mobile

      - name: validate
        description: Test all changes
        agents:
          - validator
        depends_on:
          - add-theme

    checkpoints:
      analysis-complete:
        description: Mobile analysis report created
        condition: "file_exists(~/repos/vudo.univrs.io/MOBILE_ANALYSIS.md)"

      mobile-fixed:
        description: Mobile rendering works
        condition: "npm run build succeeds"

      theme-added:
        description: Theme toggle functional
        condition: "ThemeContext.tsx and ThemeToggle.tsx exist"

      all-validated:
        description: All tests pass
        condition: "TEST_REPORT.md shows all green"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CONTEXT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

context:
  repos:
    working:
      - path: ~/repos/univrs.io
        description: Main site - works on mobile
      - path: ~/repos/learn.univrs.io
        description: Docs site - works on mobile
    broken:
      - path: ~/repos/vudo.univrs.io
        description: VUDO landing - BROKEN on mobile

  known_issues:
    - "Three.js Canvas may not initialize on mobile WebGL"
    - "No Suspense fallback visible means entire app fails"
    - "Fixed positioning can break mobile layouts"

  color_scheme:
    dark:
      bg: "#0a0a0f"
      surface: "#12121a"
      glow: "#00ff88"
      accent: "#8b5cf6"
      gold: "#fbbf24"
    light:
      bg: "#f8fafc"
      surface: "#ffffff"
      glow: "#059669"
      accent: "#7c3aed"
      gold: "#d97706"
